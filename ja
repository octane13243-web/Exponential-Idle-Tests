import { ExponentialCost } from "./api/Costs";
import { BigNumber } from "./api/BigNumber";
import { theory } from "./api/Theory";
import { Utils } from "./api/Utils";

// Basic theory info
var id = "barebones_skeleton";
var name = "Barebones Skeleton";
var description = "A simple working theory with 2 upgrades, a tick, and primary equation display.";
var authors = "You#0000";
var version = 1;
var releaseOrder = "1";

requiresGameVersion("1.4.33");

// Core variables
var currency, rho_dot = BigNumber.ZERO;
var x1 = BigNumber.ZERO, x2 = BigNumber.ZERO;

// Upgrades
var x1Upg, x2Upg;

var init = () => {
    currency = theory.createCurrency();

    // Upgrade x1: exponential 2^level
    x1Upg = theory.createUpgrade(0, currency, new ExponentialCost(10, Math.log2(2)));
    x1Upg.getDescription = (level) => "x_1 = " + BigNumber.from(2).pow(x1Upg.level).toString();
    x1Upg.getInfo = (amount) => "x_1 = " + BigNumber.from(2).pow(x1Upg.level + amount).toString();

    // Upgrade x2: exponential 2^level
    x2Upg = theory.createUpgrade(1, currency, new ExponentialCost(100, Math.log2(2)));
    x2Upg.getDescription = (level) => "x_2 = " + BigNumber.from(2).pow(x2Upg.level).toString();
    x2Upg.getInfo = (amount) => "x_2 = " + BigNumber.from(2).pow(x2Upg.level + amount).toString();
};

var tick = (elapsedTime, multiplier) => {
    let dt = BigNumber.from(elapsedTime) * BigNumber.from(multiplier);

    // Update x1 and x2 values
    x1 = BigNumber.from(2).pow(x1Upg.level);
    x2 = BigNumber.from(2).pow(x2Upg.level);

    // rho_dot calculation
    rho_dot = x1 * x2 * dt;

    // Update currency
    currency.value += rho_dot;

    theory.invalidatePrimaryEquation();
};

var getPrimaryEquation = () => {
    theory.primaryEquationHeight = 50;
    return "\\dot{\\rho} = x_1 \\cdot x_2";
};

// Optional: reset function
var postPublish = () => {
    rho_dot = BigNumber.ZERO;
    x1 = BigNumber.ZERO;
    x2 = BigNumber.ZERO;
};

init();