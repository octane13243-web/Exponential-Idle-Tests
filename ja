import { ExponentialCost } from "./api/Costs";
import { BigNumber } from "./api/BigNumber";
import { theory } from "./api/Theory";

// --- Meta ---
var id = "safe_barebones";
var name = "Safe Barebones";
var description = "A fully safe EI skeleton, ready to expand.";
var authors = "horchata#0000";
var version = 1;

requiresGameVersion("1.4.33");

// --- Currency & State ---
var currency;
var rho_dot = BigNumber.ZERO;

// --- Upgrade ---
var x1;

// --- Init Function ---
var init = () => {
    // create currency
    currency = theory.createCurrency();
    currency.value = BigNumber.ONE; // initial value

    // simple upgrade
    x1 = theory.createUpgrade(0, currency, new ExponentialCost(10, Math.log2(2)));
    x1.level = 0;
    x1.getDescription = (_) => "xâ‚ upgrade";
    x1.getInfo = (_) => "Level: " + x1.level;
};

// --- Tick Function ---
var tick = (elapsedTime, multiplier) => {
    // convert everything to BigNumber safely
    let dt = BigNumber.from(elapsedTime).mul(BigNumber.from(multiplier));
    let x1val = BigNumber.ONE.add(BigNumber.from(x1.level));

    // calculate rho_dot safely
    rho_dot = x1val.mul(dt);

    // update currency manually (works in all SDK versions)
    let newVal = BigNumber.from(currency.value.toNumber() + rho_dot.toNumber());
    currency.value = newVal;
};

// --- Reset Function ---
var reset = (hardReset) => {
    x1.level = 0;
    rho_dot = BigNumber.ZERO;
    currency.value = BigNumber.ONE;
};

// --- Internal State ---
var getInternalState = () => `${x1.level}`;
var setInternalState = (state) => {
    let values = state.split(" ");
    if (values.length > 0) x1.level = parseInt(values[0]);
};

// --- Init ---
init();
