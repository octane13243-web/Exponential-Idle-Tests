import { ExponentialCost, FirstFreeCost } from "./api/Costs";
import { Localization } from "./api/Localization";
import { BigNumber } from "./api/BigNumber";
import { theory } from "./api/Theory";
import { Utils } from "./api/Utils";

var id = "c1_log_rho";
var name = "Logarithmic Growth";
var description = "A simple theory based on logarithmic growth.";
var authors = "horchata";
var version = 1;

var currency;
var c1;

function init() {
    // ✅ THIS WAS THE BUG
    currency = theory.createCurrency();

    // c1 upgrade
    c1 = theory.createUpgrade(
        0,
        currency,
        new FirstFreeCost(new ExponentialCost(10, 1.15))
    );

    c1.getDescription = (_) => Utils.getMath("c1");
    c1.getInfo = (amount) =>
        Utils.getMathTo(
            "c1 = " + getC1Value(c1.level),
            "c1 = " + getC1Value(c1.level + amount)
        );

    // equations
    theory.primaryEquationHeight = 50;
    theory.primaryEquation = "\\rho = 2 \\cdot \\frac{\\log_{10}(c1)}{5}";
    theory.secondaryEquation = "";
    theory.tertiaryEquation = "";

    theory.invalidatePrimaryEquation();
}

function getC1Value(level) {
    // starts at 2 so log10(c1) ≠ 0
    return 2 + level;
}

function tick(elapsedTime, multiplier) {
    if (c1.level == 0) return;

    let dt = BigNumber.from(elapsedTime * multiplier);

    let c1Value = getC1Value(c1.level);
    let logTerm = Math.log10(c1Value);

    let rhoDot = 2 * (logTerm / 5);

    currency.value += dt * rhoDot;
}

init();
