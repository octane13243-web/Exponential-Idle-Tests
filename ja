import { ExponentialCost, CompositeCost } from "./api/Costs";
import { BigNumber } from "./api/BigNumber";
import { theory } from "./api/Theory";
import { Utils } from "./api/Utils";

// Basic info
var id = "barebones_full";
var name = "Barebones Full Theory";
var description = "A working theory with x1, x2, permanents, milestones, and a proper tick.";
var authors = "You#0000";
var version = 1;
var releaseOrder = "1";

requiresGameVersion("1.4.33");

// Core variables
var currency, rho_dot = BigNumber.ZERO;
var x1 = BigNumber.ZERO, x2 = BigNumber.ZERO;

// Upgrades
var x1Upg, x2Upg;

// Permanents
var permPub, permBuyAll, permAuto;

// Milestones
var milestone1, milestone2;

var init = () => {
    currency = theory.createCurrency();

    // ---- Regular upgrades ----
    x1Upg = theory.createUpgrade(0, currency, new ExponentialCost(10, Math.log2(2)));
    x1Upg.getDescription = (level) => "x_1 = " + BigNumber.from(2).pow(x1Upg.level).toString();
    x1Upg.getInfo = (amount) => "x_1 = " + BigNumber.from(2).pow(x1Upg.level + amount).toString();

    x2Upg = theory.createUpgrade(1, currency, new ExponentialCost(100, Math.log2(2)));
    x2Upg.getDescription = (level) => "x_2 = " + BigNumber.from(2).pow(x2Upg.level).toString();
    x2Upg.getInfo = (amount) => "x_2 = " + BigNumber.from(2).pow(x2Upg.level + amount).toString();

    // ---- Permanent Upgrades ----
    permPub = theory.createPublicationUpgrade(0, currency, 1e5);
    permBuyAll = theory.createBuyAllUpgrade(1, currency, 1e8);
    permAuto = theory.createAutoBuyerUpgrade(2, currency, 1e10);

    // ---- Milestones ----
    milestone1 = theory.createMilestoneUpgrade(0, 2);
    milestone1.getDescription = (_) => "Multiply x1 by 2";
    milestone1.getInfo = (_) => "x1 upgrade effect doubled";
    milestone1.boughtOrRefunded = (_) => theory.invalidatePrimaryEquation();

    milestone2 = theory.createMilestoneUpgrade(1, 2);
    milestone2.getDescription = (_) => "Multiply x2 by 2";
    milestone2.getInfo = (_) => "x2 upgrade effect doubled";
    milestone2.boughtOrRefunded = (_) => theory.invalidatePrimaryEquation();
};

var tick = (elapsedTime, multiplier) => {
    let dt = BigNumber.from(elapsedTime) * BigNumber.from(multiplier);

    // Apply milestone multipliers
    let x1val = BigNumber.from(2).pow(x1Upg.level) * (milestone1.level + 1);
    let x2val = BigNumber.from(2).pow(x2Upg.level) * (milestone2.level + 1);

    rho_dot = x1val * x2val * dt;

    currency.value += rho_dot;

    theory.invalidatePrimaryEquation();
};

var getPrimaryEquation = () => {
    theory.primaryEquationHeight = 50;
    return "\\dot{\\rho} = x_1 \\cdot x_2 \\cdot (Milestones)";
};

// Optional: reset
var postPublish = () => {
    rho_dot = BigNumber.ZERO;
    x1 = BigNumber.ZERO;
    x2 = BigNumber.ZERO;
};

init();